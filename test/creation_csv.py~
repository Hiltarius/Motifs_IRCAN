# coding: utf-8

# script permettant de générer un fichier csv contenant le top 20
# des motifs présent pour chaque fichier txt résultant de k_seek_4.
#Ceci afin de pouvoir obtenir un cluster des différents motifs affichés en fonction du top 20 des motifs.


import os
from itertools import islice
import sys
import re

# parse the output in order to sort the tandems according to their counts



##### GET TOP 20 FILES #####

path = os.getcwd()
for input_file in os.listdir(path):
    if input_file.endswith(".total"):
        dico={}
        with open(input_file) as f :
            for line in f:
                data = line.split()
                dico[data[0]]=int(data[1])


        small_filename = 'total_sort_{}.txt'.format(input_file)

        file = open(small_filename,'w')

        for key, value in sorted(dico.iteritems(), key=lambda x: int(x[1]),reverse=True):   
            file.write( "%s    %s\n" % (key, value))

        file.close()

  
        with open(small_filename,"r") as myfile:
            head=list(islice(myfile,20))
      
        top20_file = 'top20_sort_{}.txt'.format(input_file)

        with open(top20_file,"w") as f2 :
            for item in head:
                f2.write(item)

        os.remove(small_filename)



    


#### DATA BASE CSV CREATION #####
database = {}

for input_file in os.listdir(path):
    if input_file.startswith("top20_"):
        with open(input_file) as f:
            liste =[]
            for line in f :
                data = line.split()
                liste.append(data[0])
            cpt=1
	    
            for i in liste :
	        print i 
                print input_file
                database[input_file]["top"+cpt]=i
                cpt+=1
        

def creation_csv(db):
    
    print("csv creation")
    csv =open("table.csv", "w")
    csv.write("accession;top1;top2;top3;top4;top5;top6;top7;top8;top9;top10;top11;top12;top13;top14;top15;top16;top17;top18;top19;top20\n")
    cpt = 20
    for key in db.keys():
        
        row=str(key)+";"

        for i in range(cpt) :
            row +=db[key]["top"+str(i+1)]+";"
        row = row[:-1]    
        row += "\n"
    """
    # last resort
    
        acces = key
        top1=db[key]["top1"]
        top2=db[key]["top2"]
        top3=db[key]["top3"]
        top4=db[key]["top4"]
        top5=db[key]["top5"]
        top6=db[key]["top6"]
        top7=db[key]["top7"]
        top8=db[key]["top8"]
        top9=db[key]["top9"]
        top10=db[key]["top10"]
        top11=db[key]["top11"]
        top12=db[key]["top12"]
        top13=db[key]["top13"]
        top14=db[key]["top14"]
        top15=db[key]["top15"]
        top16=db[key]["top16"]
        top17=db[key]["top17"]
        top18=db[key]["top18"]
        top19=db[key]["top19"]
        top20=db[key]["top20"]
        row = str(acces) + ";"+ str(top1) + ";" + str(top2) + ";" + str(top3) + ";" + str(top4) + ";" + str(top5) + ";" + str(top6) + ";" + str(top7) + ";" + str(top8) + ";" +str(top9) + ";"+ str(top10) + ";"+ str(top11) + ";"+ str(top12) + ";"+ str(top13) + ";"+ str(top14) + ";"+ str(top15) + ";"+ str(top16) + ";"+ str(top17) + ";"+ str(top18) + ";"+ str(top19) + ";"+ str(top20) +"\n"
        
    """
    
    
    

    

creation_csv(database)





